<script setup lang="ts">
import { computed } from 'vue';
import { useAppStore } from '@/store/app';
import { useRoute, useRouter } from 'vue-router';
import Button from 'primevue/button';
import BaseMenuItem from './BaseMenuItem.vue';

const store = useAppStore()
const route = useRoute()
const router = useRouter()

const logout = () => {
  localStorage.removeItem('access_token')
  localStorage.removeItem('user')
  router.push({ name: 'auth-login' })
}

const sidebarClass = computed(() => ({
  'fixed inset-y-0 left-0 z-50 w-64 transition-transform duration-300 ease-in-out transform': true,
  '-translate-x-full': !store.visible,
  'translate-x-0': store.visible
}));

</script>

<template>
  <div class="flex flex-col min-h-screen bg-surface-0 dark:bg-surface-900">
    <div class="flex flex-grow">
      <!-- Sidebar -->
      <aside :class="sidebarClass" class="bg-surface-0 dark:bg-surface-900 shadow-lg py-4">
        <div class="flex justify-center items-center py-4">
          <svg width="113" height="20" viewBox="0 0 113 20" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M14.3706 19.7339L12.9588 15.1031H5.86011L4.44836 19.7339H0L6.87231 0.199601H11.92L18.819 19.7339H14.3706ZM11.9733 11.6434L10.5615 7.1191C10.4727 6.81748 10.3529 6.43158 10.2019 5.96141C10.0599 5.48237 9.91336 4.99889 9.76241 4.51098C9.62035 4.01419 9.50492 3.58394 9.41613 3.22023C9.32734 3.58394 9.20304 4.03637 9.04322 4.57751C8.89228 5.10978 8.74577 5.61544 8.60371 6.09448C8.46165 6.57352 8.35954 6.91506 8.29739 7.1191L6.89895 11.6434H11.9733Z" fill="black"/>
            <path d="M27.5835 8.80905H35.3082V18.8955C34.2872 19.2326 33.2261 19.5032 32.1251 19.7073C31.0241 19.9024 29.7766 20 28.3827 20C26.447 20 24.8044 19.6185 23.4548 18.8556C22.1052 18.0927 21.0797 16.9661 20.3783 15.4757C19.6768 13.9854 19.3261 12.1535 19.3261 9.98004C19.3261 7.93968 19.7168 6.17432 20.4981 4.68397C21.2884 3.19361 22.4382 2.04036 23.9476 1.22422C25.4659 0.408073 27.3172 0 29.5014 0C30.5314 0 31.548 0.110889 32.5513 0.332668C33.5546 0.554447 34.4647 0.842759 35.2816 1.1976L33.9098 4.49767C33.3149 4.19605 32.6357 3.94322 31.8721 3.73919C31.1085 3.53515 30.3094 3.43313 29.4748 3.43313C28.2761 3.43313 27.2328 3.70814 26.3449 4.25815C25.4659 4.80816 24.7822 5.57995 24.2939 6.57352C23.8144 7.55822 23.5747 8.72034 23.5747 10.0599C23.5747 11.3285 23.7478 12.4551 24.0941 13.4398C24.4404 14.4156 24.9865 15.183 25.7323 15.7418C26.4781 16.2919 27.4504 16.5669 28.649 16.5669C29.235 16.5669 29.7278 16.5403 30.1274 16.487C30.5358 16.4249 30.9176 16.3628 31.2728 16.3007V12.2422H27.5835V8.80905Z" fill="black"/>
            <path d="M44.539 0.279441C46.3059 0.279441 47.762 0.492349 48.9074 0.918164C50.0617 1.34398 50.9185 1.98714 51.4779 2.84764C52.0373 3.70814 52.3169 4.79485 52.3169 6.10778C52.3169 6.9949 52.1482 7.77112 51.8108 8.43646C51.4734 9.1018 51.0295 9.66511 50.479 10.1264C49.9285 10.5877 49.3336 10.9647 48.6943 11.2575L54.4213 19.7339H49.8397L45.1916 12.2688H42.994V19.7339H38.8653V0.279441H44.539ZM44.246 3.65935H42.994V8.9155H44.3259C45.6932 8.9155 46.6699 8.68929 47.2559 8.23686C47.8508 7.77556 48.1483 7.10135 48.1483 6.21424C48.1483 5.29164 47.8286 4.63517 47.1893 4.24484C46.5589 3.85451 45.5778 3.65935 44.246 3.65935Z" fill="black"/>
            <path d="M67.2746 14.3313C67.2746 15.4846 66.9949 16.487 66.4356 17.3387C65.8762 18.1903 65.0593 18.8468 63.985 19.3081C62.9195 19.7694 61.6232 20 60.096 20C59.4212 20 58.7597 19.9556 58.1115 19.8669C57.4722 19.7782 56.8552 19.6496 56.2603 19.481C55.6743 19.3036 55.1149 19.0863 54.5821 18.829V14.9967C55.5056 15.4047 56.4645 15.7729 57.4589 16.1011C58.4534 16.4294 59.4389 16.5935 60.4156 16.5935C61.0904 16.5935 61.632 16.5048 62.0405 16.3273C62.4578 16.1499 62.7597 15.906 62.9461 15.5955C63.1326 15.285 63.2258 14.9301 63.2258 14.5309C63.2258 14.043 63.0616 13.6261 62.733 13.2801C62.4045 12.9341 61.9517 12.6103 61.3745 12.3087C60.8063 12.0071 60.1626 11.6833 59.4434 11.3373C58.9905 11.1244 58.4978 10.8672 57.965 10.5655C57.4323 10.255 56.9262 9.87802 56.4467 9.43446C55.9673 8.99091 55.5722 8.4542 55.2614 7.82435C54.9595 7.18563 54.8086 6.42271 54.8086 5.5356C54.8086 4.37348 55.0749 3.37991 55.6077 2.55489C56.1404 1.72987 56.8996 1.10002 57.8851 0.665336C58.8796 0.221779 60.0516 0 61.4012 0C62.4134 0 63.3768 0.11976 64.2913 0.359281C65.2147 0.589931 66.1781 0.927035 67.1814 1.37059L65.8495 4.57751C64.9528 4.21379 64.1492 3.93435 63.4389 3.73919C62.7286 3.53515 62.005 3.43313 61.268 3.43313C60.753 3.43313 60.3135 3.51741 59.9495 3.68596C59.5854 3.84564 59.3102 4.07629 59.1237 4.37791C58.9373 4.67066 58.844 5.0122 58.844 5.40253C58.844 5.86383 58.9772 6.25416 59.2436 6.57352C59.5188 6.88401 59.9273 7.18563 60.4689 7.47838C61.0194 7.77112 61.7031 8.11266 62.5199 8.50299C63.5144 8.97316 64.3623 9.46551 65.0638 9.98004C65.7741 10.4857 66.3201 11.0845 66.7019 11.7764C67.0837 12.4595 67.2746 13.3112 67.2746 14.3313Z" fill="black"/>
            <path d="M81.6329 19.7339L80.2212 15.1031H73.1225L71.7107 19.7339H67.2624L74.1347 0.199601H79.1824L86.0813 19.7339H81.6329ZM79.2356 11.6434L77.8239 7.1191C77.7351 6.81748 77.6152 6.43158 77.4643 5.96141C77.3222 5.48237 77.1757 4.99889 77.0248 4.51098C76.8827 4.01419 76.7673 3.58394 76.6785 3.22023C76.5897 3.58394 76.4654 4.03637 76.3056 4.57751C76.1546 5.10978 76.0081 5.61544 75.8661 6.09448C75.724 6.57352 75.6219 6.91506 75.5597 7.1191L74.1613 11.6434H79.2356Z" fill="black"/>
            <path d="M87.4542 19.7339V0.279441H91.5829V16.3273H99.4807V19.7339H87.4542Z" fill="black"/>
            <path d="M113 19.7339H101.786V0.279441H113V3.65935H105.915V7.93081H112.507V11.3107H105.915V16.3273H113V19.7339Z" fill="black"/>
          </svg>
        </div>
        <nav class="h-full overflow-y-auto py-4">
          <ul v-for="section in store.menuItems" :key="section.label" class="list-none m-0">
            <li>
              <div v-if="section.label" class="p-4 flex items-center justify-between text-surface-500 dark:text-surface-400">
                <span class="font-medium">{{ section.label }}</span>
              </div>
              <ul class="list-none p-0 m-0 overflow-hidden">
                <BaseMenuItem v-for="item in section.items" :key="item.label" :item="item" />
              </ul>
            </li>
          </ul>
        </nav>
      </aside>

      <!-- Main Content -->
      <main class="flex-grow p-4 transition-all duration-300" :class="{ 'ml-64': store.visible }" :style="{ background: '#f1f5f9' }">
        <!-- Header -->
        <header class="flex justify-between">
          <div class="flex gap-6 items-center">
            <Button @click="store.toggleVisible" icon="pi pi-bars" style="color: var(--p-slate-700)" text rounded aria-label="menu"></Button>
            <span class="font-bold text-base text-gray-500">{{ route.meta.title }}</span>
          </div>
          <Button @click="logout" icon="pi pi-sign-out" style="color: var(--p-slate-700)" text rounded aria-label="menu"></Button>
        </header>
        <div class="mt-4 h-[90%]">
          <slot></slot>
        </div>
      </main>
    </div>
  </div>
</template>

<style scoped>
/* Add any additional styles here */
</style>